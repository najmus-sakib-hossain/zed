<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bash Demo — almostnode agent runtime</title>
    <link rel="stylesheet" href="./shared-styles.css" />
    <style>
      .layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 1fr 200px;
        gap: 1px;
        background: var(--border);
        height: calc(100vh - 44px);
      }
      .terminal-panel { grid-column: 1 / -1; }
      @media (max-width: 768px) {
        .layout {
          grid-template-columns: 1fr;
          grid-template-rows: 1fr 300px 200px;
        }
        .terminal-panel { grid-column: 1; }
      }
    </style>
  </head>
  <body>
    <div class="demo-topbar">
      <a href="../index.html" class="back">← demos</a>
      <span class="sep">/</span>
      <a href="../index.html" class="logo">almostnode</a>
      <span class="sep">/</span>
      <span class="title">Bash + Node</span>
      <span class="tag">child_process · exec</span>
    </div>

    <div class="layout">
      <div class="panel">
        <div class="panel-header">
          <span class="panel-label">script.js</span>
          <button id="runBtn" class="btn btn-primary">Run Script</button>
        </div>
        <textarea id="editor">const { exec } = require('child_process');
const fs = require('fs');

console.log('=== Agent Runtime Bash Demo ===\n');

// Create some files using Node.js fs
fs.writeFileSync('/data/users.json', JSON.stringify([
  { name: 'Alice', role: 'admin' },
  { name: 'Bob', role: 'user' },
  { name: 'Charlie', role: 'user' }
], null, 2));

fs.writeFileSync('/data/config.txt', 'DEBUG=true\nPORT=3000\nHOST=localhost');

console.log('Created files with Node.js fs module\n');

// Now use bash commands to explore them
exec('ls -la /data', (err, stdout) => {
  console.log('Files in /data:');
  console.log(stdout);
});

// Use cat to read a file
exec('cat /data/users.json', (err, stdout) => {
  console.log('Content of users.json:');
  console.log(stdout);
});

// Use grep to search
exec('grep "admin" /data/users.json', (err, stdout) => {
  console.log('Lines containing "admin":');
  console.log(stdout || '(no matches)');
});

// Use pipes
exec('cat /data/config.txt | grep PORT', (err, stdout) => {
  console.log('Config PORT setting:');
  console.log(stdout);
});

// Use wc to count
exec('cat /data/users.json | wc -l', (err, stdout) => {
  console.log('Line count:');
  console.log(stdout.trim() + ' lines');
});

// Chain commands
exec('echo "Hello" && echo "World" && echo "!"', (err, stdout) => {
  console.log('Chained commands:');
  console.log(stdout);
});

// Use awk for data processing
exec('echo "apple 5\\nbanana 3\\norange 7" | awk \'{print $1, "has", $2, "items"}\'', (err, stdout) => {
  console.log('AWK processing:');
  console.log(stdout);
});

// Environment variables
exec('echo "User: $USER, Home: $HOME"', (err, stdout) => {
  console.log('Environment:');
  console.log(stdout);
});

console.log('\nAll commands executed.');</textarea>
      </div>

      <div class="panel">
        <div class="panel-header">
          <span class="panel-label">Preview</span>
          <div style="display:flex;align-items:center;gap:6px;">
            <div class="status-dot running" id="statusDot"></div>
            <span class="panel-label" id="status">Ready</span>
          </div>
        </div>
        <iframe id="preview" class="preview-frame"></iframe>
      </div>

      <div class="panel terminal-panel">
        <div class="panel-header">
          <span class="panel-label">Console</span>
        </div>
        <div id="terminal" class="terminal"></div>
      </div>
    </div>

    <script type="module" src="/src/demo.ts"></script>
  </body>
</html>
